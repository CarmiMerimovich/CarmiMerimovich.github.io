<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta content="text/html; charset=iso-8859-8-i" http-equiv="content-type">
  <title>אסמבלי ב-VC++</title>
  <meta content="Tsahi Asher" name="author">
  <style type="text/css">
  /*workaround for bug 74880 in mozilla*/
  ul, ol, blockquote {
  padding-right: 25px;
  }
  </style>
</head>
<body dir="rtl">
<h2 style="text-align: center;">התקנת MS-Visual C++ 6.0 לעבודה באסמבלי</h2>
<p>ההסבר להלן מנוסח בלשון זכר, כי כך קובעים חוקי הדקדוק העברי.</p>

<p>אם עוד אין לך <a target="_blank" href="http://www.winzip.com">WinZip</a> במחשב, אז הגיע הזמן להתקין,
או לנסות את <a href="http://www.izarc.org/">IZArc</a> החינמית, שלא תנג'ס לשלם בכל הפעלה.</p>

<p>בהסבר להלן, VC או VC6 פירושו Visual C++&lrm;</p>

<p>ההסבר להלן יסביר כיצד להכין את VC6 לעבודה בשפת אסמבלי, מבלי להתקין את
השדרוג המלא (Visual C++ 6.0 Processor Pack) המוצע על ידי Microsoft. יש להניח
שהתקנת כל החבילה תקל על העבודה מבחינות מסויימות, אבל לא בדקתי. הנוהל שיוצג להלן
אינו מיועד לבעלי לב חלש.</p>

<h4>התקנת האסמבלר</h4>

<p>תחילה יש להשיג את קובץ ההתקנה. ניתן לקבל אותו בספריית המכללה (<a href="http://www.mta.ac.il/">מכללת תל
אביב-יפו</a>, אם אתה אורח פה) על דיסק, או להוריד אותו
<a target="_blank" href="http://msdn.microsoft.com/vstudio/downloads/tools/ppack/default.aspx">מאתר
Microsoft</a> (אני השתמשתי בקובץ המיועד למי שהתקין את Service Pack 5, הנקרא
vcpp5.exe, שהוא הקובץ הניתן בספריה). עתה, פתח את WinZip, ופתח איתו את הקובץ,
כאילו היה קובץ דחוס רגיל. אתה תראה את רשימת הקבצים. מצא את הקובץ ml.exe (קל
יותר לעשות זאת אם מסדרים את הקבצים בסדר אלפביתי, על ידי לחיצה על כותרת עמודת
הקבצים), ושמור אותו (בחר extract מסרגל הכלים) בתיקייה Microsoft Visual
Studio<b>\</b>VC98<b>\</b>Bin שתהייה בדר"כ תחת תיקיית Program Files.</p>

<h4>קביעת תצורת סביבת הפיתוח</h4>

<ol>
  <li>הורד את הקבצים <a href="do.bat">do.bat</a> ו-<a href="dos.bat">dos.bat</a>
  (לחיצה ימנית>שמור מטרת קישור ברוב הדפדפנים). קבצים אלה זהים למעשה לקבצים שניתנו
  <a href="http://www2.mta.ac.il/~carmi/Teaching/2005-6A-Assembly/Lec01.html"
  target="_blank">באתר הקורס</a> (סמסטר א' 2005, הרצאה ראשונה), אך הם מכילים גם
  הערות תיעוד המסבירות מה קורה שם, וכן כיבוי של פלט פקודות האצווה למסך. פלט
  האסמבלר והלינקר נראים.
  <li>הקובץ dos.bat מכיל את שם קובץ ההפעלה שיווצר בתום תהליך הפיתוח. מסיבה זו,
  יהיה צורך לערוך אותו מחדש עבור כל פרוייקט. לאור זאת, יש שתי דרכים להשתמש
  בקבצים אלו:
  <ol style="list-style: hebrew">
  	<li>להעתיק אותם מחדש אל כל פרוייקט חדש, לאחר ש-VC יצור את תיקיית הפרוייקט.
    לשיטה זו יש יתרון, בכך שניתן יהיה לחזור בקלות יחסית לעבוד על פרוייקטים
    ישנים.</li>
  	<li>לשים אותם בתיקייה MyProjects (שתחתיה נשמרים בדר"כ הפרוייקטים). במקרה זה
    יהיה צורך להוסיף תיקייה זו אל התיקיות בהן VC מחפש קבצים:
    <ol type="I">
    	<li>פתח את תפריט Tools של VC ובחר Options:<br>
      <img src="2b1.gif" border="0" width="800" height="363" alt="tools menu">
      </li>
    	<li>בחלון Options בחר בלשונית Directories, ושם בחר Executable files
      מהתפריט Show directories for:<br>
      <img src="2b2.gif" border="0" width="800" height="569" alt="options
      window" vspace="15">
      </li>
    	<li>צור רשומה חדשה על ידי בחירה בצלמית המתאימה, והוספת התיקייה MyProjects
      לרשימה.<br>
      <img src="2b3.gif" border="0" width="800" height="568" alt="new record"
      vspace="15">
      </li>
    	<li>לחץ OK לאישור.</li>
    </ol>
    היתרון בשיטה זו הוא שאין צורך להעתיק את הקבצים מחדש אל כל פרוייקט.
    </li>
  </ol>
  <li>פתח את VC,סגור כל פרוייקט פתוח ופתח פרוייקט חדש מסוג Makefile מתפריט
  File>New:<br>
  <img align="middle" alt="חלון פרוייקט חדש" src="1.gif" width="800"
  height="568" vspace="15">
  <li>בחלון החדש שיפתח יש להכניס את הנתונים עבור שלב ניפוי הבאגים (debug), שהוא
  השלב בו אנחנו עובדים בדר"כ. הכנס את הערכים הבאים:
  <ul type="disc">
  	<li>Command line: dos</li>
  	<li>Output: sample.exe (או איזה שם שתרצה לקובץ הריצה)</li>
  	<li>Rebuild All Switch: ריק</li>
  </ul>
  מאוחר יותר ניתן יהיה לשנות ערכים אלה מתפריט Project > Settings, אם יהיה צורך.
  <li>לחיצה על Next תיקח אותך לחלון דומה, הפעם עבור שלב יצור גרסת ההפצה, שכזכור,
  אינה מכילה את טבלת הסמלים ומידע נוסף המשמש את ה-debugger בשלב הקודם. אפשר
  להכניס פה את אותם הנתונים, למרות שבאופן מעשי יהיה צורך להשתמש בקובץ do.bat
  מעט שונה. לחץ על Finish.
  <li>הוסף את קבצי האצווה (קבצי ה-bat.) אל הפרוייקט, ואם כבר יש לך קובץ קוד
  מוכן, אז גם אותו:<br>
  <img src="6.gif" border="0" width="800" height="568" alt="add file to project"
  vspace="15"><br>
  שים לב שלאחר שלב זה אפשר לערוך את dos.bat בהתאם לשם קובץ הריצה שהכנסנו בשלב יצירת
  הפרוייקט, ובהתאם לשמות קבצי המקור בהם נשתמש. בדוגמה זו, ניצור קובץ בשם
  sample.exe מקובץ המקור main.asm.
  <img src="6b.gif" border="0" width="800" height="572" alt="bat files"
  vspace="15">
  <li>לחיצה על F10 תביא אותנו כרגיל אל מנפה הבאגים. כאן ניתן לבחור לראות את
  תמונת הזיכרון ואת הרגיסטרים מתפריט View > Debug Windows:<br>
  <img src="7.gif" border="0" width="800" height="569" alt="view windows"
  vspace="15">
  <li>בחירה ב-Disassembly מאותו תפריט תביא אותנו לתצוגה הבאה:<br>
  <img src="8.gif" border="0" width="800" height="568" alt="disassembly"
  vspace="15"><br>
  אם אין לך את כפתור Disassembly בסרגל הכלים, אפשר להוסיף אותו מתפריט Tools >
  Customize. לאחר מכן, ניתן להחליף בין שתי התצוגות על ידי לחיצה על הכפתור החדש.
  <br><img src="9.gif" border="0" width="117" height="71" alt="disassembly button"
  vspace="15">
</ol>
לתגובות והערות: 
<script language="JavaScript" type="text/javascript">
<!--   // Hide
//var showtext = "כאן";
var mailpart1 = "t_asher";
var mailpart2 = "netvision.net.il";
document.write("<a href=" + "mail" + "to:" + mailpart1 +
"@" + mailpart2 + ">" + mailpart1 + "@" + mailpart2 + "<\/a>")
//-->
</script> 
</body>
</html>